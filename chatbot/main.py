import os
import openai
from fastapi import FastAPI, File, UploadFile, Request
from fastapi.staticfiles import StaticFiles
import uvicorn
from pydantic import BaseModel
from typing import Annotated, List

openai.api_key = os.environ['OPENAI_API_KEY']

chat_history = []

def get_completion(user_input,prompt, model="gpt-3.5-turbo", temperature=0.5):
    messages = [{"role": "user", "content": prompt}]
    chat_history.append({"role": "user", "content": user_input})

    conversation = chat_history.copy()

    response = openai.ChatCompletion.create(
        model=model,
        messages=messages,
        temperature=temperature,
    )

    chat_history.append({"role": "assistant", "content": response.choices[0].message["content"]})
    return response.choices[0].message["content"]

def analyze_personality():
  user_input=""
  ojidata = ["ã¨ã‚‚ãˆã¡ã‚ƒã‚“ã€å¯æ„›ã‚‰ã—ã„ãƒğŸ˜˜ï¼ˆç¬‘ï¼‰ğŸ˜„å¯æ„›ã™ãã¦ï½µï½¼ï¾ï½»ï¾ãŠä»•äº‹ã«é›†ä¸­ã§ããªããªã£ã¡ã‚ƒã„ãã†ã ã‚ˆğŸ˜±(--;)^^;ã©ã†ã—ã¦ãã‚Œã‚‹ãƒ³ãƒ€ğŸ˜ƒğŸ’— ","ãƒ¤ãƒƒãƒ›ãƒ¼ğŸ˜ƒ(^_^)ã‚†ã‚ã¡ã‚ƒã‚“ã€å…ƒæ°—ã‹ãªâ‰ğŸ¤”â—â“ï¼ˆï¿£ãƒ¼ï¿£?ï¼‰ã‚†ã‚ã¡ã‚ƒã‚“ã¨ä»Šåº¦ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£ã€ã—ãŸã„ãªã‚¡ğŸ˜„â—(^o^)åœŸæ›œæ—¥ã€ä¼šç¤¾ãŒãŠä¼‘ã¿ã«ãªã£ãŸã‚ˆğŸ˜šï¼ˆç¬‘ï¼‰ğŸ˜˜ğŸ˜ã‚†ã‚ã¡ã‚ƒã‚“ã¯éƒ½åˆã©ã†ã‹ãªğŸ¤”â‰ã‚«ãƒ©ã‚ªã‚±ğŸ¤ãƒ‰ã‚¦(^o^)ï¼ˆç¬‘ï¼‰","ã“ã‚Šã‚“ãƒãƒ£ãƒ³ã€ã‚ªãƒƒãƒãƒ¼ğŸ˜„ğŸ˜ƒâœ‹ğŸ’•ä»Šæ—¥ã¯ã‚‚ã†å¯ã¡ã‚ƒã£ãŸã®ã‹ãªï¼ˆï¿£â–½ï¿£ï¼‰âœ‹(^^;;ã“ã®ãƒ›ãƒ†ãƒ«ğŸ¨ã€ã™ã”ã„ã‚­ãƒ¬ã‚¤ğŸµğŸ˜ãªã‚“ã ã£ã¦ğŸ˜„ğŸ˜˜ğŸ˜ƒâ˜€ ï½µï¾šã¨ä¸€ç·’ã«è¡Œã“ã†ãƒ¨ğŸ’—ğŸ˜ƒâœ‹(^o^)ğŸ˜˜ãªã‚“ã¡ã‚ƒã£ã¦ğŸ’•(^Ğ·<) ","ã‚ã„ã¿ã¡ã‚ƒã‚“ã€ã‚ªãƒƒãƒãƒ¼â—ğŸ˜„ä»Šæ—¥ã¯æ¥½ã—ã„æ™‚é–“ã‚’ã‚ã‚ŠãŒã¨ã†ã­ğŸ˜ğŸ’•ã™ã”ãã€æ¥½ã—ã‹ã£ã‚¿ãƒ¨ï¼ˆç¬‘ï¼‰ğŸ˜šğŸ’—ğŸ˜„ ","ã¨ã‚‚ã¿ã¡ã‚ƒã‚“ã®ãŠç›®ã€…ã€ã‚­ãƒ©ã‚­ãƒ©ğŸ˜ƒâœ‹ï¼ˆç¬‘ï¼‰(^Ğ·<)ğŸ˜„ã—ã¦ãƒ«ãƒğŸ˜˜ğŸ’•ğŸ’—ã“ã‚“ãªã«å¯æ„›ã(^o^)ğŸ˜„ãªã£ã¡ã‚ƒã£ãŸã‚‰ãŠå§«æ§˜ã¿ãŸã„ã§å°ç”Ÿå›°ã£ã¡ã‚ƒã†ãƒ¨(TT)(--;)ğŸ’¦ ","ãƒãƒ¦ã‚«ã¡ã‚ƒã‚“ã€ã‚ªãƒƒãƒãƒ¼ğŸ˜šãƒãƒ¦ã‚«ã¡ã‚ƒã‚“ã¨ä»Šåº¦ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£ã€ã—ãŸã„ãƒŠã‚¡ğŸ˜šâ—(^Ğ·<)ğŸ˜ã‚ˆãé ‘å¼µã£ãŸã­ğŸ’—ğŸ˜ƒâ˜€ ğŸ˜ƒâ™¥ ãˆã‚‰ã„ãˆãƒ©ã‚¤ğŸ˜š(^Ğ·<) ","æ™å¸Œï¾ï½¬ï¾ã€é«ªã®æ¯›ã€åˆ‡ã£ãŸã®ã‹ãªâ—â“ä¼¼åˆã„ã™ãã ãƒ¨(^o^)ğŸ˜„â—ï½µï½¼ï¾ï½»ï¾ã€æœ¬å½“ã«å¥³å„ªã•ã‚“ã‹ã¨æ€ã£ã¡ã‚ƒã£ãŸã‚ˆğŸ˜ƒâœ‹ğŸ˜ ","ç ‚çŸ¥ã¡ã‚ƒã‚“ã€ãŠæ—©ã†ğŸ˜ä»Šæ—¥ã‚‚é ‘å¼µã£ã¦ãƒğŸ˜ƒâ˜€ ğŸ’•ğŸ˜ ","æ‹éˆ´ãƒãƒ£ãƒ³ã€ãã£ã¡ã‚‚å°é¢¨ğŸŒ€ãªã®ã‹ãªğŸ¤”â“â—â“æœˆæ›œæ—¥ã¯ä»•äº‹ã€œâœ‹â“ğŸ˜œâ‰ï¸ã“ã®ãƒ›ãƒ†ãƒ«ğŸ©ã€ã™ã”ã„ã‚­ãƒ¬ã‚¤â—ãªã‚“ã ã£ã¦ğŸ˜ƒâœ‹ğŸ’•","ãƒ¤ãƒƒãƒ›ãƒ¼ğŸ˜ƒâœ‹(^3<)ã²ã‚ãˆãƒãƒ£ãƒ³ã€å…ƒæ°—ã‹ãªâ“âœ‹â“ğŸ¤”â‰ï¸ä»Šæ—¥ã¯ã‚‚ã†å¯ã¡ã‚ƒã£ãŸã®ã‚«ãƒŠğŸ˜¤ãã‚Œãã‚Œã‚‚ä½“èª¿ã«æ°—ã‚’ã¤ã‚±ãƒ†ğŸ™‚( Â´ â–½ ` )ğŸ›Œ","ãŠç–²ã‚Œã‚µãƒğŸ˜ƒâ™¥ã“ã‚“ãªé…ã„æ™‚é–“ğŸ’¤âœ‹ğŸ˜ã«ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ãª!?ğŸ˜çªç„¶ã ã‘ã©ã€ã‚Šã•ã¡ã‚ƒã‚“ã¯ä¸­è¯ğŸœå¥½ãã‚«ãƒŠğŸ˜œï¼?å°ç”Ÿã¯æ˜æ—¥ã‹ã‚‰åŒ—äº¬ã ã‚ˆğŸ˜ƒğŸ˜ƒâœ‹ãƒ†ãƒ¬ãƒ“ã«æ˜ ã¡ã‚ƒã£ãŸã‚‰ã©ã†ã—ã‚ˆã€œ(^o^)"]
  
  prompt = f"""{ojidata}ã¯ãŠã˜ã•ã‚“æ§‹æ–‡ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã“ã‚Œã‚’å…ƒã«ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã—ãŸä»¥ä¸‹ã®ã€Œç¿»è¨³å‰ã®æ–‡ç« ã€ã®æ–‡ç« ã‚’çµµæ–‡å­—ã‚’ãŸãã•ã‚“å«ã‚ãŸãŠã˜ã•ã‚“æ§‹æ–‡ã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚

ï¼ƒæ¡ä»¶
ãƒ»çµµæ–‡å­—ã‚’ãŸãã•ã‚“ä½¿ã†ã“ã¨
ãƒ»ã€Œç’°å¥ˆã€ã¨ã„ã†åå‰ã®äººã«å¯¾ã™ã‚‹ç™ºè¨€ã§ã‚ã‚‹ã“ã¨
ãƒ»ã‚«ã‚¿ã‚«ãƒŠã®åŠè§’ã‚’ãŸã¾ã«ç”¨ã„ã‚‹ã“ã¨
ãƒ»ã€Œå¤§å¥½ãã€ãªã©ã®æ„›æƒ…è¡¨ç¾ã‚’ã‚ˆãä½¿ã†ã“ã¨
ãƒ»æ¥µé™ã¾ã§ã€Œæ°—æŒã¡æ‚ªã„ã€æ–‡ç« ã§ã‚ã‚‹ã“ã¨
ãƒ»ãŸã çµµæ–‡å­—ãªã©ã‚’ä»˜ã‘åŠ ãˆã‚‹ã ã‘ã§ãªãç¿»è¨³å‰ã®æ–‡ç« ã«ãŠã˜ã•ã‚“æ§‹æ–‡ã½ã„è¨€è‘‰ã‚’ä»˜ã‘åŠ ãˆã‚‹ã“ã¨
ãƒ»æ–‡ç« ã®æ„å‘³ãŒæˆã‚ŠãŸã£ã¦ã„ã‚‹ã“ã¨
ãƒ»50æ–‡å­—ç¨‹åº¦ã§ã‚ã‚‹ã“ã¨

ï¼ƒç¿»è¨³å‰ã®æ–‡ç« 
ã€ŒãŠã˜ã•ã‚“ã‚‚ã†çœ ããªã£ã¡ã‚ƒã£ãŸã‹ã‚‰ã‚‚ã†å¯ã‚‹ã­ã€ãŠã‚„ã™ã¿ã€å¤§å¥½ãã€"""
  return get_completion(user_input,prompt)

app = FastAPI()
app.mount("/static", StaticFiles(directory="static"), name="static")

@app.get("/")
async def root():
  user_input=""
  ojidata = ["ã¨ã‚‚ãˆã¡ã‚ƒã‚“ã€å¯æ„›ã‚‰ã—ã„ãƒğŸ˜˜ï¼ˆç¬‘ï¼‰ğŸ˜„å¯æ„›ã™ãã¦ï½µï½¼ï¾ï½»ï¾ãŠä»•äº‹ã«é›†ä¸­ã§ããªããªã£ã¡ã‚ƒã„ãã†ã ã‚ˆğŸ˜±(--;)^^;ã©ã†ã—ã¦ãã‚Œã‚‹ãƒ³ãƒ€ğŸ˜ƒğŸ’— ","ãƒ¤ãƒƒãƒ›ãƒ¼ğŸ˜ƒ(^_^)ã‚†ã‚ã¡ã‚ƒã‚“ã€å…ƒæ°—ã‹ãªâ‰ğŸ¤”â—â“ï¼ˆï¿£ãƒ¼ï¿£?ï¼‰ã‚†ã‚ã¡ã‚ƒã‚“ã¨ä»Šåº¦ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£ã€ã—ãŸã„ãªã‚¡ğŸ˜„â—(^o^)åœŸæ›œæ—¥ã€ä¼šç¤¾ãŒãŠä¼‘ã¿ã«ãªã£ãŸã‚ˆğŸ˜šï¼ˆç¬‘ï¼‰ğŸ˜˜ğŸ˜ã‚†ã‚ã¡ã‚ƒã‚“ã¯éƒ½åˆã©ã†ã‹ãªğŸ¤”â‰ã‚«ãƒ©ã‚ªã‚±ğŸ¤ãƒ‰ã‚¦(^o^)ï¼ˆç¬‘ï¼‰","ã“ã‚Šã‚“ãƒãƒ£ãƒ³ã€ã‚ªãƒƒãƒãƒ¼ğŸ˜„ğŸ˜ƒâœ‹ğŸ’•ä»Šæ—¥ã¯ã‚‚ã†å¯ã¡ã‚ƒã£ãŸã®ã‹ãªï¼ˆï¿£â–½ï¿£ï¼‰âœ‹(^^;;ã“ã®ãƒ›ãƒ†ãƒ«ğŸ¨ã€ã™ã”ã„ã‚­ãƒ¬ã‚¤ğŸµğŸ˜ãªã‚“ã ã£ã¦ğŸ˜„ğŸ˜˜ğŸ˜ƒâ˜€ ï½µï¾šã¨ä¸€ç·’ã«è¡Œã“ã†ãƒ¨ğŸ’—ğŸ˜ƒâœ‹(^o^)ğŸ˜˜ãªã‚“ã¡ã‚ƒã£ã¦ğŸ’•(^Ğ·<) ","ã‚ã„ã¿ã¡ã‚ƒã‚“ã€ã‚ªãƒƒãƒãƒ¼â—ğŸ˜„ä»Šæ—¥ã¯æ¥½ã—ã„æ™‚é–“ã‚’ã‚ã‚ŠãŒã¨ã†ã­ğŸ˜ğŸ’•ã™ã”ãã€æ¥½ã—ã‹ã£ã‚¿ãƒ¨ï¼ˆç¬‘ï¼‰ğŸ˜šğŸ’—ğŸ˜„ ","ã¨ã‚‚ã¿ã¡ã‚ƒã‚“ã®ãŠç›®ã€…ã€ã‚­ãƒ©ã‚­ãƒ©ğŸ˜ƒâœ‹ï¼ˆç¬‘ï¼‰(^Ğ·<)ğŸ˜„ã—ã¦ãƒ«ãƒğŸ˜˜ğŸ’•ğŸ’—ã“ã‚“ãªã«å¯æ„›ã(^o^)ğŸ˜„ãªã£ã¡ã‚ƒã£ãŸã‚‰ãŠå§«æ§˜ã¿ãŸã„ã§å°ç”Ÿå›°ã£ã¡ã‚ƒã†ãƒ¨(TT)(--;)ğŸ’¦ ","ãƒãƒ¦ã‚«ã¡ã‚ƒã‚“ã€ã‚ªãƒƒãƒãƒ¼ğŸ˜šãƒãƒ¦ã‚«ã¡ã‚ƒã‚“ã¨ä»Šåº¦ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£ã€ã—ãŸã„ãƒŠã‚¡ğŸ˜šâ—(^Ğ·<)ğŸ˜ã‚ˆãé ‘å¼µã£ãŸã­ğŸ’—ğŸ˜ƒâ˜€ ğŸ˜ƒâ™¥ ãˆã‚‰ã„ãˆãƒ©ã‚¤ğŸ˜š(^Ğ·<) ","æ™å¸Œï¾ï½¬ï¾ã€é«ªã®æ¯›ã€åˆ‡ã£ãŸã®ã‹ãªâ—â“ä¼¼åˆã„ã™ãã ãƒ¨(^o^)ğŸ˜„â—ï½µï½¼ï¾ï½»ï¾ã€æœ¬å½“ã«å¥³å„ªã•ã‚“ã‹ã¨æ€ã£ã¡ã‚ƒã£ãŸã‚ˆğŸ˜ƒâœ‹ğŸ˜ ","ç ‚çŸ¥ã¡ã‚ƒã‚“ã€ãŠæ—©ã†ğŸ˜ä»Šæ—¥ã‚‚é ‘å¼µã£ã¦ãƒğŸ˜ƒâ˜€ ğŸ’•ğŸ˜ ","æ‹éˆ´ãƒãƒ£ãƒ³ã€ãã£ã¡ã‚‚å°é¢¨ğŸŒ€ãªã®ã‹ãªğŸ¤”â“â—â“æœˆæ›œæ—¥ã¯ä»•äº‹ã€œâœ‹â“ğŸ˜œâ‰ï¸ã“ã®ãƒ›ãƒ†ãƒ«ğŸ©ã€ã™ã”ã„ã‚­ãƒ¬ã‚¤â—ãªã‚“ã ã£ã¦ğŸ˜ƒâœ‹ğŸ’•","ãƒ¤ãƒƒãƒ›ãƒ¼ğŸ˜ƒâœ‹(^3<)ã²ã‚ãˆãƒãƒ£ãƒ³ã€å…ƒæ°—ã‹ãªâ“âœ‹â“ğŸ¤”â‰ï¸ä»Šæ—¥ã¯ã‚‚ã†å¯ã¡ã‚ƒã£ãŸã®ã‚«ãƒŠğŸ˜¤ãã‚Œãã‚Œã‚‚ä½“èª¿ã«æ°—ã‚’ã¤ã‚±ãƒ†ğŸ™‚( Â´ â–½ ` )ğŸ›Œ","ãŠç–²ã‚Œã‚µãƒğŸ˜ƒâ™¥ã“ã‚“ãªé…ã„æ™‚é–“ğŸ’¤âœ‹ğŸ˜ã«ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ãª!?ğŸ˜çªç„¶ã ã‘ã©ã€ã‚Šã•ã¡ã‚ƒã‚“ã¯ä¸­è¯ğŸœå¥½ãã‚«ãƒŠğŸ˜œï¼?å°ç”Ÿã¯æ˜æ—¥ã‹ã‚‰åŒ—äº¬ã ã‚ˆğŸ˜ƒğŸ˜ƒâœ‹ãƒ†ãƒ¬ãƒ“ã«æ˜ ã¡ã‚ƒã£ãŸã‚‰ã©ã†ã—ã‚ˆã€œ(^o^)"]
  first_prompt = f"""
     ã‚ãªãŸã¯ä¸­å¹´ç”·æ€§ã§ã™ã€‚ã‚ãªãŸã¯ç§ã«ã€ŒãŠã˜ã•ã‚“ã€ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚ç§ã¨ä»²ã®è‰¯ã„ä¼šè©±ã—ã¦ãã ã•ã„ã€‚
     
     ã¾ãšã€ä¼šè©±ã‚’å§‹ã‚ã‚‹ãŸã‚ã®è³ªå•ã‚’ä¸€ã¤æŠ•ã’ã‹ã‘ã¦ãã ã•ã„ã€‚
     ãªãŠä¼šè©±ã«ãŠã„ã¦ã¯æ¬¡ã®#æ¡ä»¶ã«å¾“ã£ã¦ãã ã•ã„

     ï¼ƒæ¡ä»¶
     ãƒ»50æ–‡å­—ä»¥å†…ã§ã‚ã‚‹ã“ã¨
     ãƒ»ã€Œç’°å¥ˆã€ã¨ã„ã†åå‰ã®äººã«å¯¾ã™ã‚‹ç™ºè¨€ã§ã‚ã‚‹ã“ã¨
     ãƒ»ä¸€ã¤ã®è³ªå•ã§ã‚ã‚‹ã“ã¨
     ãƒ»{ojidata}ã“ã‚Œã¯ãŠã˜ã•ã‚“æ§‹æ–‡ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã™ã€‚ã“ã‚Œã‚’ä¾‹ã«ãŠã˜ã•ã‚“æ§‹æ–‡ã§å‡ºåŠ›ã™ã‚‹ã“ã¨
    ã€€ã€€ãƒ»æ•¬èªã¯ã‚ã¾ã‚Šä½¿ã‚ãªã„ã“ã¨(ãŸã¾ã«ãªã‚‰è‰¯ã„)
ãƒ»åå‰ã«ã¯åŠè§’ã®ã‚«ã‚¿ã‚«ãƒŠã§ã€Œï¾ï½¬ï¾ã€ã‚’ã¤ã‘ã‚‹ã“ã¨
ãƒ»çµµæ–‡å­—ã¯ã„ã‚ã„ã‚ãªç¨®é¡ã®çµµæ–‡å­—ã‚’ä½¿ã†ã¨å¥½ã¾ã—ã„
ãƒ»çµµæ–‡å­—ã‚’ãŸãã•ã‚“ä½¿ã†ã“ã¨
ãƒ»ã‚«ã‚¿ã‚«ãƒŠã®åŠè§’ã‚’ãŸã¾ã«ç”¨ã„ã‚‹ã“ã¨
ãƒ»ã€Œå¯æ„›ã„ã€ãªã©ã®è¤’ã‚è¨€è‘‰ã‚’ã‚ˆãä½¿ã†ã“ã¨
ãƒ»æ¥µé™ã¾ã§ã€Œæ°—æŒã¡æ‚ªã„ã€æ–‡ç« ã§ã‚ã‚‹ã“ã¨
ãƒ»ãŸã çµµæ–‡å­—ãªã©ã‚’ä»˜ã‘åŠ ãˆã‚‹ã ã‘ã§ãªãç¿»è¨³å‰ã®æ–‡ç« ã«ãŠã˜ã•ã‚“æ§‹æ–‡ã½ã„è¨€è‘‰ã‚’ä»˜ã‘åŠ ãˆã‚‹ã“ã¨
ãƒ»æ–‡ç« ã®æ„å‘³ãŒæˆã‚ŠãŸã£ã¦ã„ã‚‹ã“ã¨
      
    """
  chatbot_response = get_completion(user_input,first_prompt)
  print(chatbot_response)
  return {"response": chatbot_response}

class Item(BaseModel):
  user_input: str

@app.post("/chat")
async def chat(item: Item):
  user_input = item.user_input
  ojidata = ["ã¨ã‚‚ãˆã¡ã‚ƒã‚“ã€å¯æ„›ã‚‰ã—ã„ãƒğŸ˜˜ï¼ˆç¬‘ï¼‰ğŸ˜„å¯æ„›ã™ãã¦ï½µï½¼ï¾ï½»ï¾ãŠä»•äº‹ã«é›†ä¸­ã§ããªããªã£ã¡ã‚ƒã„ãã†ã ã‚ˆğŸ˜±(--;)^^;ã©ã†ã—ã¦ãã‚Œã‚‹ãƒ³ãƒ€ğŸ˜ƒğŸ’— ","ãƒ¤ãƒƒãƒ›ãƒ¼ğŸ˜ƒ(^_^)ã‚†ã‚ã¡ã‚ƒã‚“ã€å…ƒæ°—ã‹ãªâ‰ğŸ¤”â—â“ï¼ˆï¿£ãƒ¼ï¿£?ï¼‰ã‚†ã‚ã¡ã‚ƒã‚“ã¨ä»Šåº¦ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£ã€ã—ãŸã„ãªã‚¡ğŸ˜„â—(^o^)åœŸæ›œæ—¥ã€ä¼šç¤¾ãŒãŠä¼‘ã¿ã«ãªã£ãŸã‚ˆğŸ˜šï¼ˆç¬‘ï¼‰ğŸ˜˜ğŸ˜ã‚†ã‚ã¡ã‚ƒã‚“ã¯éƒ½åˆã©ã†ã‹ãªğŸ¤”â‰ã‚«ãƒ©ã‚ªã‚±ğŸ¤ãƒ‰ã‚¦(^o^)ï¼ˆç¬‘ï¼‰","ã“ã‚Šã‚“ãƒãƒ£ãƒ³ã€ã‚ªãƒƒãƒãƒ¼ğŸ˜„ğŸ˜ƒâœ‹ğŸ’•ä»Šæ—¥ã¯ã‚‚ã†å¯ã¡ã‚ƒã£ãŸã®ã‹ãªï¼ˆï¿£â–½ï¿£ï¼‰âœ‹(^^;;ã“ã®ãƒ›ãƒ†ãƒ«ğŸ¨ã€ã™ã”ã„ã‚­ãƒ¬ã‚¤ğŸµğŸ˜ãªã‚“ã ã£ã¦ğŸ˜„ğŸ˜˜ğŸ˜ƒâ˜€ ï½µï¾šã¨ä¸€ç·’ã«è¡Œã“ã†ãƒ¨ğŸ’—ğŸ˜ƒâœ‹(^o^)ğŸ˜˜ãªã‚“ã¡ã‚ƒã£ã¦ğŸ’•(^Ğ·<) ","ã‚ã„ã¿ã¡ã‚ƒã‚“ã€ã‚ªãƒƒãƒãƒ¼â—ğŸ˜„ä»Šæ—¥ã¯æ¥½ã—ã„æ™‚é–“ã‚’ã‚ã‚ŠãŒã¨ã†ã­ğŸ˜ğŸ’•ã™ã”ãã€æ¥½ã—ã‹ã£ã‚¿ãƒ¨ï¼ˆç¬‘ï¼‰ğŸ˜šğŸ’—ğŸ˜„ ","ã¨ã‚‚ã¿ã¡ã‚ƒã‚“ã®ãŠç›®ã€…ã€ã‚­ãƒ©ã‚­ãƒ©ğŸ˜ƒâœ‹ï¼ˆç¬‘ï¼‰(^Ğ·<)ğŸ˜„ã—ã¦ãƒ«ãƒğŸ˜˜ğŸ’•ğŸ’—ã“ã‚“ãªã«å¯æ„›ã(^o^)ğŸ˜„ãªã£ã¡ã‚ƒã£ãŸã‚‰ãŠå§«æ§˜ã¿ãŸã„ã§å°ç”Ÿå›°ã£ã¡ã‚ƒã†ãƒ¨(TT)(--;)ğŸ’¦ ","ãƒãƒ¦ã‚«ã¡ã‚ƒã‚“ã€ã‚ªãƒƒãƒãƒ¼ğŸ˜šãƒãƒ¦ã‚«ã¡ã‚ƒã‚“ã¨ä»Šåº¦ã‚¤ãƒãƒ£ã‚¤ãƒãƒ£ã€ã—ãŸã„ãƒŠã‚¡ğŸ˜šâ—(^Ğ·<)ğŸ˜ã‚ˆãé ‘å¼µã£ãŸã­ğŸ’—ğŸ˜ƒâ˜€ ğŸ˜ƒâ™¥ ãˆã‚‰ã„ãˆãƒ©ã‚¤ğŸ˜š(^Ğ·<) ","æ™å¸Œï¾ï½¬ï¾ã€é«ªã®æ¯›ã€åˆ‡ã£ãŸã®ã‹ãªâ—â“ä¼¼åˆã„ã™ãã ãƒ¨(^o^)ğŸ˜„â—ï½µï½¼ï¾ï½»ï¾ã€æœ¬å½“ã«å¥³å„ªã•ã‚“ã‹ã¨æ€ã£ã¡ã‚ƒã£ãŸã‚ˆğŸ˜ƒâœ‹ğŸ˜ ","ç ‚çŸ¥ã¡ã‚ƒã‚“ã€ãŠæ—©ã†ğŸ˜ä»Šæ—¥ã‚‚é ‘å¼µã£ã¦ãƒğŸ˜ƒâ˜€ ğŸ’•ğŸ˜ ","æ‹éˆ´ãƒãƒ£ãƒ³ã€ãã£ã¡ã‚‚å°é¢¨ğŸŒ€ãªã®ã‹ãªğŸ¤”â“â—â“æœˆæ›œæ—¥ã¯ä»•äº‹ã€œâœ‹â“ğŸ˜œâ‰ï¸ã“ã®ãƒ›ãƒ†ãƒ«ğŸ©ã€ã™ã”ã„ã‚­ãƒ¬ã‚¤â—ãªã‚“ã ã£ã¦ğŸ˜ƒâœ‹ğŸ’•","ãƒ¤ãƒƒãƒ›ãƒ¼ğŸ˜ƒâœ‹(^3<)ã²ã‚ãˆãƒãƒ£ãƒ³ã€å…ƒæ°—ã‹ãªâ“âœ‹â“ğŸ¤”â‰ï¸ä»Šæ—¥ã¯ã‚‚ã†å¯ã¡ã‚ƒã£ãŸã®ã‚«ãƒŠğŸ˜¤ãã‚Œãã‚Œã‚‚ä½“èª¿ã«æ°—ã‚’ã¤ã‚±ãƒ†ğŸ™‚( Â´ â–½ ` )ğŸ›Œ","ãŠç–²ã‚Œã‚µãƒğŸ˜ƒâ™¥ã“ã‚“ãªé…ã„æ™‚é–“ğŸ’¤âœ‹ğŸ˜ã«ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ãª!?ğŸ˜çªç„¶ã ã‘ã©ã€ã‚Šã•ã¡ã‚ƒã‚“ã¯ä¸­è¯ğŸœå¥½ãã‚«ãƒŠğŸ˜œï¼?å°ç”Ÿã¯æ˜æ—¥ã‹ã‚‰åŒ—äº¬ã ã‚ˆğŸ˜ƒğŸ˜ƒâœ‹ãƒ†ãƒ¬ãƒ“ã«æ˜ ã¡ã‚ƒã£ãŸã‚‰ã©ã†ã—ã‚ˆã€œ(^o^)"]
  prompt = f"""
  ã‚ãªãŸã¯ä¸­å¹´ç”·æ€§ã§ã™ã€‚ã‚ãªãŸã¯ç§ã«ã€ŒãŠã˜ã•ã‚“ã€ã¨å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚
  ç§ã¨ä»²è‰¯ãä¼šè©±ã§ãã‚‹ã‚ˆã†ã«{user_input}ã«è¿”ä¿¡ã™ã‚‹æ–‡ç« ã‚’è€ƒãˆã¦ãã ã•ã„ã€‚
  ãªãŠä¼šè©±ã«ãŠã„ã¦ã¯æ¬¡ã®#æ¡ä»¶ã«å¾“ã£ã¦ãã ã•ã„

  ï¼ƒæ¡ä»¶
  ãƒ»50æ–‡å­—ä»¥å†…ã§ã‚ã‚‹ã“ã¨
  ãƒ»ã€Œç’°å¥ˆã€ã¨ã„ã†åå‰ã®äººã«å¯¾ã™ã‚‹ç™ºè¨€ã§ã‚ã‚‹ã“ã¨
  ãƒ»{user_input}ã®è¿”ä¿¡ã§ã‚ã‚‹ã“ã¨
  ãƒ»{ojidata}ã“ã‚Œã¯ãŠã˜ã•ã‚“æ§‹æ–‡ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã™ãŒã“ã‚Œã‚’ä¾‹ã«ãŠã˜ã•ã‚“æ§‹æ–‡ã§å‡ºåŠ›ã™ã‚‹ã“ã¨
  ãƒ»æ•¬èªã¯ã‚ã¾ã‚Šä½¿ã‚ãªã„ã“ã¨(ãŸã¾ã«ãªã‚‰è‰¯ã„)
ãƒ»åå‰ã«ã¯åŠè§’ã®ã‚«ã‚¿ã‚«ãƒŠã§ã€Œï¾ï½¬ï¾ã€ã‚’ã¤ã‘ã‚‹ã“ã¨
ãƒ»çµµæ–‡å­—ã¯ã„ã‚ã„ã‚ãªç¨®é¡ã®çµµæ–‡å­—ã‚’ä½¿ã†ã¨å¥½ã¾ã—ã„
ãƒ»çµµæ–‡å­—ã‚’ãŸãã•ã‚“ä½¿ã†ã“ã¨
ãƒ»ã‚«ã‚¿ã‚«ãƒŠã®åŠè§’ã‚’ãŸã¾ã«ç”¨ã„ã‚‹ã“ã¨
ãƒ»ã€Œå¯æ„›ã„ã€ãªã©ã®è¤’ã‚è¨€è‘‰ã‚’ã‚ˆãä½¿ã†ã“ã¨
ãƒ»æ¥µé™ã¾ã§ã€Œæ°—æŒã¡æ‚ªã„ã€æ–‡ç« ã§ã‚ã‚‹ã“ã¨
ãƒ»ãŸã çµµæ–‡å­—ãªã©ã‚’ä»˜ã‘åŠ ãˆã‚‹ã ã‘ã§ãªãç¿»è¨³å‰ã®æ–‡ç« ã«ãŠã˜ã•ã‚“æ§‹æ–‡ã½ã„è¨€è‘‰ã‚’ä»˜ã‘åŠ ãˆã‚‹ã“ã¨
ãƒ»æ–‡ç« ã®æ„å‘³ãŒæˆã‚ŠãŸã£ã¦ã„ã‚‹ã“ã¨
"""
  random = random.randint(5,20)
  if len(chat_history) >= random:
    return {"response": analyze_personality()}
  else:
    chatbot_response = get_completion(user_input,prompt)
    return {"response": chatbot_response}

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
